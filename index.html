<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="icon" type="image/jpeg" href="/icon.jpg">
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Secret</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;600&family=Lora:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 24px 0;
        font-family: system-ui, -apple-system, BlinkMacSystemFont,
          "SF Pro Text", "Segoe UI", sans-serif;
        background: radial-gradient(circle at 0% 0%, #ff9a9e 0, transparent 55%),
          radial-gradient(circle at 100% 0%, #fad0c4 0, transparent 55%),
          radial-gradient(circle at 0% 100%, #fbc2eb 0, transparent 55%),
          radial-gradient(circle at 100% 100%, #a18cd1 0, transparent 55%),
          linear-gradient(
            135deg,
            #f6d365 0%,
            #fda085 25%,
            #fbc2eb 60%,
            #a18cd1 100%
          );
        color: #ffffff;
        overflow-x: hidden;
        overflow-y: auto;
      }

      body.hint-open {
        align-items: flex-start;
      }

      main {
        position: relative;
        z-index: 1;
        width: 100%;
        max-width: 760px;
        padding: 24px;
      }

      .glass-card {
        backdrop-filter: blur(24px);
        -webkit-backdrop-filter: blur(24px);
        background: rgba(0, 0, 0, 0.22);
        border-radius: 24px;
        border: 1px solid rgba(255, 255, 255, 0.32);
        box-shadow: 0 24px 60px rgba(0, 0, 0, 0.35);
      }

      /* PAGE ONE: PASSWORD VIEW */

      #login-view {
        max-width: 460px;
        margin: 0 auto;
        padding: 28px 24px 24px;
      }

      form {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .input-row {
        display: flex;
        gap: 8px;
      }

      input[type="password"] {
        flex: 1;
        padding: 10px 12px;
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.55);
        background: rgba(0, 0, 0, 0.16);
        color: #ffffff;
        font-size: 0.95rem;
        outline: none;
      }

      input[type="password"]::placeholder {
        color: rgba(255, 255, 255, 0.6);
      }

      input[type="password"]:focus {
        border-color: #ffffff;
        box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.6);
      }

      button {
        border: none;
        border-radius: 999px;
        padding: 10px 18px;
        font-size: 0.95rem;
        font-weight: 500;
        cursor: pointer;
        background: rgba(255, 255, 255, 0.9);
        color: #222222;
        white-space: nowrap;
        transition: transform 0.12s ease, box-shadow 0.12s ease,
          background 0.12s ease;
      }

      button:hover {
        transform: translateY(-1px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        background: #ffffff;
      }

      button:active {
        transform: translateY(0);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
      }

      #error-message {
        min-height: 1.2em;
        font-size: 0.8rem;
        color: #ffd2d2;
        text-align: left;
      }

      /* Hint / mini-game section */

      #hint-section {
        margin-top: 18px;
        padding-top: 14px;
        border-top: 1px solid rgba(255, 255, 255, 0.25);
      }

      #hint-toggle {
        font-size: 0.8rem;
        padding: 6px 14px;
        background: rgba(0, 0, 0, 0.22);
        color: #ffffff;
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.7);
      }

      #hint-toggle:hover {
        background: rgba(0, 0, 0, 0.32);
      }

      #hint-game {
        margin-top: 12px;
        padding: 0 10px;
        border-radius: 18px;
        background: rgba(0, 0, 0, 0.34);
        border: 1px solid rgba(255, 255, 255, 0.22);
        max-height: 0;
        opacity: 0;
        overflow: hidden;
        transform: translateY(-8px);
        transition: max-height 0.55s cubic-bezier(0.22, 0.61, 0.36, 1),
          opacity 0.4s ease-out,
          transform 0.55s cubic-bezier(0.22, 0.61, 0.36, 1),
          padding 0.4s ease-out;
        pointer-events: none;
      }

      #hint-game.open {
        padding: 10px 10px 12px;
        max-height: 600px;
        opacity: 1;
        transform: translateY(0);
        pointer-events: auto;
      }

      #hint-game-intro {
        font-size: 0.78rem;
        text-align: center;
        opacity: 0.85;
      }

      #maze-container {
        margin-top: 8px;
        display: flex;
        justify-content: center;
      }

      #maze-grid {
        display: grid;
        grid-template-columns: repeat(25, 12px);
        grid-auto-rows: 12px;
        gap: 2px;
      }

      .maze-cell {
        border-radius: 4px;
        background: rgba(255, 255, 255, 0.15);
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.45) inset;
      }

      .maze-wall {
        background: rgba(0, 0, 0, 0.6);
        box-shadow: none;
      }

      .maze-player {
        background: #ffffff;
        box-shadow: 0 0 0 2px rgba(161, 140, 209, 0.9);
      }

      .maze-goal {
        background: rgba(253, 160, 133, 0.95);
      }

      #maze-controls {
        margin-top: 10px;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 4px;
      }

      .maze-ctrl-row {
        display: flex;
        gap: 6px;
      }

      .maze-ctrl {
        padding: 4px 10px;
        font-size: 0.8rem;
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.7);
        background: rgba(0, 0, 0, 0.2);
        color: #ffffff;
        cursor: pointer;
      }

      .maze-ctrl:hover {
        background: rgba(0, 0, 0, 0.32);
      }

      #maze-hint-text {
        margin-top: 6px;
        font-size: 0.8rem;
        text-align: center;
        color: #ffeac7;
        min-height: 1.2em;
      }

      /* PAGE TWO: LETTER VIEW */

      #content-view {
        display: none;
      }

      #content-shell {
        position: relative;
        padding: 56px 18px 24px;
        max-height: 70vh;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 16px;
      }

      /* Center the letter cluster when collapsed */
      #content-shell.centered {
        justify-content: center;
      }

      #back-button {
        position: absolute;
        top: 18px;
        left: 18px;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        background: rgba(0, 0, 0, 0.3);
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.4);
        padding: 8px 14px;
        font-size: 0.85rem;
        color: #ffffff;
      }

      #back-button span:first-child {
        font-size: 0.95rem;
      }

      #letter-card {
        margin: 4px auto 10px auto;
        width: 100%;
        max-width: 640px;
        border-radius: 22px;
        background: #fdf4ec;
        color: #2a1c16;
        box-shadow: 0 22px 40px rgba(0, 0, 0, 0.45);
        border: 1px solid rgba(139, 105, 82, 0.18);
        font-family: "Lora", "Georgia", "Times New Roman", serif;
        overflow: hidden;
        cursor: pointer;
        transition: max-height 0.55s cubic-bezier(0.22, 0.61, 0.36, 1),
          padding 0.4s ease-out, box-shadow 0.3s ease-out,
          transform 0.2s ease-out;
      }

      #letter-card:hover {
        box-shadow: 0 26px 60px rgba(0, 0, 0, 0.55);
        transform: translateY(-1px);
      }

      #letter-card.collapsed {
        padding: 18px 24px;
        max-height: 82px;
      }

      #letter-card.expanded {
        padding: 30px 26px 30px;
        max-height: 800px;
      }

      #letter-content {
        margin-top: 10px;
        opacity: 0;
        transform: translateY(4px);
        transition: opacity 0.35s ease-out 0.1s,
          transform 0.35s ease-out 0.1s;
      }

      #letter-card.expanded #letter-content {
        opacity: 1;
        transform: translateY(0);
      }

      #letter-header-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      #letter-top-label {
        font-size: 0.7rem;
        letter-spacing: 0.18em;
        text-transform: uppercase;
        color: rgba(0, 0, 0, 0.5);
        margin-bottom: 10px;
      }

      #letter-arrow {
        font-size: 0.9rem;
        color: rgba(0, 0, 0, 0.45);
        margin-left: 8px;
        transition: transform 0.3s ease-out;
      }

      #letter-card.expanded #letter-arrow {
        transform: rotate(180deg);
      }

      #letter-heading {
        font-size: 1.4rem;
        margin-bottom: 12px;
      }

      #letter-body {
        font-size: 0.98rem;
        line-height: 1.7;
        color: #3a2820;
      }

      #letter-body p + p {
        margin-top: 1rem;
      }

      #letter-signoff {
        margin-top: 20px;
        text-align: right;
        font-style: italic;
      }

      @media (max-width: 600px) {
        #login-view {
          padding: 22px 18px 20px;
        }

        .input-row {
          flex-direction: column;
        }

        button {
          width: 100%;
          text-align: center;
        }

        #letter-card {
          padding: 24px 18px 26px;
        }
      }
    </style>
  </head>
  <body>
    <main>
      <!-- PAGE ONE: PASSWORD INPUT + MINI MAZE HINT -->
      <section id="login-view" class="glass-card">
        <form id="password-form">
          <div class="input-row">
            <input
              id="password-input"
              type="password"
              placeholder="Enter password"
              autocomplete="off"
            />
            <button type="submit">Enter</button>
          </div>
          <p id="error-message"></p>
        </form>

        <div id="hint-section">
          <button id="hint-toggle" type="button">Want a hint?</button>
          <div id="hint-game" aria-hidden="true">
            <p id="hint-game-intro">
              Guide the dot through the maze to unlock a hint.
            </p>
            <div id="maze-container">
              <div id="maze-grid"></div>
            </div>
            <div id="maze-controls">
              <button
                type="button"
                class="maze-ctrl"
                data-dir="up"
                aria-label="Move up"
              >
                ↑
              </button>
              <div class="maze-ctrl-row">
                <button
                  type="button"
                  class="maze-ctrl"
                  data-dir="left"
                  aria-label="Move left"
                >
                  ←
                </button>
                <button
                  type="button"
                  class="maze-ctrl"
                  data-dir="down"
                  aria-label="Move down"
                >
                  ↓
                </button>
                <button
                  type="button"
                  class="maze-ctrl"
                  data-dir="right"
                  aria-label="Move right"
                >
                  →
                </button>
              </div>
            </div>
            <p id="maze-hint-text"></p>
          </div>
        </div>
      </section>

      <!-- PAGE TWO: LETTER VIEW -->
      <section id="content-view" class="glass-card">
        <div id="content-shell" class="centered">
          <button id="back-button" type="button">
            <span>&larr;</span>
            <span>Back</span>
          </button>
          <div
            id="letter-card"
            class="collapsed"
            role="button"
            aria-expanded="false"
            tabindex="0"
          >
            <div id="letter-header-row">
              <div id="letter-top-label">For Maya</div>
              <span id="letter-arrow">
                ⌄
              </span>
            </div>
            <div id="letter-content">
              <h2 id="letter-heading">Hi love,</h2>
              <div id="letter-body">
                <p>
                  test test test test test test test test test test test test test
                  test test test test test test test test test test test test test
                  test test test test test test test test test test test test test
                  test test test test test test test test test test test test test
                  test test test test test test test test test test test test test
                  test test test test test test test test test test test test test
                  test test test test test test test test test test test test test
                </p>
                <p>
                  test test test test test test test test test test test test test
                  test test test test test test test test test test test test test
                  test test test test test test test test test test test test test
                  test test test test test test test test test test test test test
                  test test test test test test test test test test test test test
                  test test test test test test test test test test test test test
                </p>
              </div>
              <p id="letter-signoff">— Milo</p>
            </div>
          </div>
        </div>
      </section>
    </main>

    <script>
      (function () {
        var correctPassword = "mayapapaya";
        var form = document.getElementById("password-form");
        var input = document.getElementById("password-input");
        var error = document.getElementById("error-message");
        var loginView = document.getElementById("login-view");
        var contentView = document.getElementById("content-view");
        var backButton = document.getElementById("back-button");
        var letterCard = document.getElementById("letter-card");
        var contentShell = document.getElementById("content-shell");

        // Hint / maze elements
        var hintToggle = document.getElementById("hint-toggle");
        var hintGame = document.getElementById("hint-game");
        var mazeGrid = document.getElementById("maze-grid");
        var mazeHintText = document.getElementById("maze-hint-text");
        var mazeControls = document.querySelectorAll(".maze-ctrl");

        var mazeSize = 25;
        var mazeData = [];
        var playerPos = { x: 0, y: 0 };
        var goalPos = { x: mazeSize - 1, y: mazeSize - 1 };
        var hintUnlocked = false;

        function showError(message) {
          error.textContent = message || "";
        }

        // New maze generator:
        // Shorter main route to the goal with more branchy dead ends off it.
        function buildMaze() {
          mazeData = [];
          for (var y = 0; y < mazeSize; y++) {
            mazeData[y] = [];
            for (var x = 0; x < mazeSize; x++) {
              mazeData[y][x] = 0; // wall
            }
          }

          function inBounds(x, y) {
            return x >= 0 && x < mazeSize && y >= 0 && y < mazeSize;
          }

          function carveCell(x, y) {
            if (inBounds(x, y)) {
              mazeData[y][x] = 1;
            }
          }

          // Main relatively direct path
          var path = [];
          var x = 0;
          var y = 0;
          carveCell(x, y);
          path.push({ x: x, y: y });

          // Use 2-step moves so we leave walls between corridors
          while (x < mazeSize - 1 || y < mazeSize - 1) {
            var dirs = [];
            if (x <= mazeSize - 3) dirs.push({ dx: 2, dy: 0 }); // right
            if (y <= mazeSize - 3) dirs.push({ dx: 0, dy: 2 }); // down

            if (dirs.length === 0) break;

            var choice = dirs[Math.floor(Math.random() * dirs.length)];
            var mx = x + choice.dx / 2;
            var my = y + choice.dy / 2;
            var nx = x + choice.dx;
            var ny = y + choice.dy;

            carveCell(mx, my);
            carveCell(nx, ny);
            x = nx;
            y = ny;
            path.push({ x: x, y: y });
          }

          // Ensure we end at bottom-right
          while (x <= mazeSize - 3) {
            var mxr = x + 1;
            var nxr = x + 2;
            carveCell(mxr, y);
            carveCell(nxr, y);
            x = nxr;
            path.push({ x: x, y: y });
          }

          while (y <= mazeSize - 3) {
            var myd = y + 1;
            var nyd = y + 2;
            carveCell(x, myd);
            carveCell(x, nyd);
            y = nyd;
            path.push({ x: x, y: y });
          }

          carveCell(mazeSize - 1, mazeSize - 1);

          // Branchy dead ends off the main path
          function carveBranchFrom(cx, cy, depth) {
            if (depth <= 0) return;

            var dirs = [
              { dx: 2, dy: 0 },
              { dx: -2, dy: 0 },
              { dx: 0, dy: 2 },
              { dx: 0, dy: -2 },
            ];

            // Shuffle directions
            for (var i = dirs.length - 1; i > 0; i--) {
              var j = Math.floor(Math.random() * (i + 1));
              var tmp = dirs[i];
              dirs[i] = dirs[j];
              dirs[j] = tmp;
            }

            for (var k = 0; k < dirs.length; k++) {
              var dx = dirs[k].dx;
              var dy = dirs[k].dy;
              var nx = cx + dx;
              var ny = cy + dy;
              var mx = cx + dx / 2;
              var my = cy + dy / 2;

              if (!inBounds(nx, ny)) continue;
              if (mazeData[ny][nx] === 1) continue; // already open, skip

              carveCell(mx, my);
              carveCell(nx, ny);

              carveBranchFrom(nx, ny, depth - 1);

              // Occasionally stop early so branches stay fairly slender
              if (Math.random() < 0.5) break;
            }
          }

          // Create branches from some of the main path cells
          for (var p = 0; p < path.length; p++) {
            if (Math.random() < 0.4) {
              var cell = path[p];
              var depth = 3 + Math.floor(Math.random() * 3); // 3–5 steps
              carveBranchFrom(cell.x, cell.y, depth);
            }
          }
        }

        function renderMaze() {
          if (!mazeGrid) return;
          mazeGrid.innerHTML = "";

          for (var y = 0; y < mazeData.length; y++) {
            for (var x = 0; x < mazeData[y].length; x++) {
              var cell = document.createElement("div");
              cell.className = "maze-cell";

              if (mazeData[y][x] === 0) {
                cell.classList.add("maze-wall");
              } else {
                if (x === playerPos.x && y === playerPos.y) {
                  cell.classList.add("maze-player");
                }
                if (x === goalPos.x && y === goalPos.y) {
                  cell.classList.add("maze-goal");
                }
              }

              mazeGrid.appendChild(cell);
            }
          }
        }

        function showMazeHint() {
          if (mazeHintText) {
            mazeHintText.textContent = "Hint: papaya";
          }
          hintUnlocked = true;
        }

        function movePlayer(dx, dy) {
          var newX = playerPos.x + dx;
          var newY = playerPos.y + dy;

          if (newY < 0 || newY >= mazeData.length) return;
          if (newX < 0 || newX >= mazeData[0].length) return;
          if (mazeData[newY][newX] === 0) return; // wall

          playerPos.x = newX;
          playerPos.y = newY;
          renderMaze();

          if (
            playerPos.x === goalPos.x &&
            playerPos.y === goalPos.y &&
            !hintUnlocked
          ) {
            showMazeHint();
          }
        }

        buildMaze();

        // Password form
        form.addEventListener("submit", function (event) {
          event.preventDefault();
          var value = (input.value || "").trim();

          if (!value) {
            showError("Please enter the password.");
            return;
          }

          if (value.toLowerCase() === correctPassword) {
            loginView.style.display = "none";
            contentView.style.display = "block";
            showError("");
            input.value = "";
          } else {
            showError("Incorrect password.");
          }
        });

        // Back button
        backButton.addEventListener("click", function () {
          contentView.style.display = "none";
          loginView.style.display = "block";
          showError("");
          input.focus();
        });

        // Letter expand/collapse + center/shift behavior
        function toggleLetter() {
          if (!letterCard) return;
          var isCollapsed = letterCard.classList.contains("collapsed");

          if (isCollapsed) {
            letterCard.classList.remove("collapsed");
            letterCard.classList.add("expanded");
            letterCard.setAttribute("aria-expanded", "true");
            if (contentShell) {
              contentShell.classList.remove("centered");
            }
          } else {
            letterCard.classList.remove("expanded");
            letterCard.classList.add("collapsed");
            letterCard.setAttribute("aria-expanded", "false");
            if (contentShell) {
              contentShell.classList.add("centered");
            }
          }
        }

        if (letterCard) {
          letterCard.addEventListener("click", function () {
            toggleLetter();
          });

          letterCard.addEventListener("keydown", function (event) {
            if (event.key === "Enter" || event.key === " ") {
              event.preventDefault();
              toggleLetter();
            }
          });
        }

        // Hint toggle / game init
        if (hintToggle && hintGame) {
          hintToggle.addEventListener("click", function () {
            var isOpen = hintGame.classList.contains("open");

            if (isOpen) {
              hintGame.classList.remove("open");
              hintGame.setAttribute("aria-hidden", "true");
              document.body.classList.remove("hint-open");
              hintToggle.textContent = "Want a hint?";
            } else {
              // Reset the maze when opened
              playerPos = { x: 0, y: 0 };
              hintUnlocked = false;
              if (mazeHintText) mazeHintText.textContent = "";
              renderMaze();

              hintGame.classList.add("open");
              hintGame.setAttribute("aria-hidden", "false");
              document.body.classList.add("hint-open");
              hintToggle.textContent = "Close maze";
            }
          });
        }

        // Maze control buttons
        mazeControls.forEach(function (btn) {
          btn.addEventListener("click", function () {
            var dir = btn.getAttribute("data-dir");
            if (dir === "up") movePlayer(0, -1);
            else if (dir === "down") movePlayer(0, 1);
            else if (dir === "left") movePlayer(-1, 0);
            else if (dir === "right") movePlayer(1, 0);
          });
        });

        // Arrow keys for maze (letters remain usable in the password box)
        window.addEventListener("keydown", function (event) {
          if (!hintGame || !hintGame.classList.contains("open")) return;

          var key = event.key;
          if (key === "ArrowUp") {
            event.preventDefault();
            movePlayer(0, -1);
          } else if (key === "ArrowDown") {
            event.preventDefault();
            movePlayer(0, 1);
          } else if (key === "ArrowLeft") {
            event.preventDefault();
            movePlayer(-1, 0);
          } else if (key === "ArrowRight") {
            event.preventDefault();
            movePlayer(1, 0);
          }
        });

        window.addEventListener("DOMContentLoaded", function () {
          input.focus();
        });
      })();
    </script>
  </body>
</html>
